!function(t){var i;if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("undefined"!=typeof module)i=require("leaflet"),module.exports=t(i);else{if("undefined"==typeof window.L)throw"Leaflet must be loaded first";t(window.L)}}(function(t){return t.Control.Measure=t.Control.extend({options:{position:"topleft",zIndexOffset:2e3},onAdd:function(){var i="leaflet-control-zoom leaflet-bar leaflet-control",e=t.DomUtil.create("div",i);return this._createButton("&#8674;","Measure","leaflet-control-measure leaflet-bar-part leaflet-bar-part-top-and-bottom",e,this._toggleMeasure,this),e},_createButton:function(i,e,o,a,s,n){var l=t.DomUtil.create("a",o,a);return l.innerHTML=i,l.href="#",l.title=e,t.DomEvent.on(l,"click",t.DomEvent.stopPropagation).on(l,"click",t.DomEvent.preventDefault).on(l,"click",s,n).on(l,"dblclick",t.DomEvent.stopPropagation),l},_toggleMeasure:function(){this._measuring=!this._measuring,this._measuring?(t.DomUtil.addClass(this._container,"leaflet-control-measure-on"),this._startMeasuring()):(t.DomUtil.removeClass(this._container,"leaflet-control-measure-on"),this._stopMeasuring())},_startMeasuring:function(){this._oldCursor=this._map._container.style.cursor,this._map._container.style.cursor="crosshair",this._doubleClickZoom=this._map.doubleClickZoom.enabled(),this._map.doubleClickZoom.disable(),this._mouseMarker||(this._mouseMarker=new t.Marker(this._map.getCenter(),{icon:t.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset}).addTo(this._map)),t.DomEvent.on(this._map,"mousemove",this._mouseMove,this).on(document,"keydown",this._onKeyDown,this),this._mouseMarker.on("click",this._mouseClick,this).on("dblclick",this._finishPath,this),this._layerPaint||(this._layerPaint=t.layerGroup().addTo(this._map)),this._points||(this._points=[])},_stopMeasuring:function(){this._map._container.style.cursor=this._oldCursor,t.DomEvent.off(document,"keydown",this._onKeyDown,this).off(this._map,"mousemove",this._mouseMove,this),this._mouseMarker.off("mousedown",this._mouseClick,this).off("dblclick",this._finishPath,this),this._doubleClickZoom&&this._map.doubleClickZoom.enable(),this._layerPaint&&this._layerPaint.clearLayers(),this._restartPath()},_mouseMove:function(i){if(this._mouseMarker&&this._mouseMarker.setLatLng(i.latlng),i.latlng&&this._lastPoint&&(this._layerPaintPathTemp?this._layerPaintPathTemp.spliceLatLngs(0,2,this._lastPoint,i.latlng):this._layerPaintPathTemp=t.polyline([this._lastPoint,i.latlng],{color:"black",weight:1.5,clickable:!1,dashArray:"6,3"}).addTo(this._layerPaint),this._tooltip)){this._distance||(this._distance=0),this._updateTooltipPosition(i.latlng);var e=i.latlng.distanceTo(this._lastPoint);this._updateTooltipDistance(this._distance+e,e)}},_mouseClick:function(i){if(i.latlng){if(this._lastPoint&&this._tooltip){this._distance||(this._distance=0),this._updateTooltipPosition(i.latlng);var e=i.latlng.distanceTo(this._lastPoint);this._updateTooltipDistance(this._distance+e,e),this._distance+=e}this._createTooltip(i.latlng),this._lastPoint&&!this._layerPaintPath&&(this._layerPaintPath=t.polyline([this._lastPoint],{color:"black",weight:2,clickable:!1}).addTo(this._layerPaint)),this._layerPaintPath&&this._layerPaintPath.addLatLng(i.latlng),this._lastCircle&&this._layerPaint.removeLayer(this._lastCircle),this._lastCircle=new t.CircleMarker(i.latlng,{color:"black",opacity:1,weight:1,fill:!0,fillOpacity:1,radius:2,clickable:this._lastCircle?!0:!1}).addTo(this._layerPaint),this._lastCircle.on("click",function(){this._finishPath()},this),this._lastPoint=i.latlng}},_finishPath:function(){this._lastCircle&&this._layerPaint.removeLayer(this._lastCircle),this._tooltip&&this._layerPaint.removeLayer(this._tooltip),this._layerPaint&&this._layerPaintPathTemp&&this._layerPaint.removeLayer(this._layerPaintPathTemp),this._mouseMarker&&this._map.removeLayer(this._mouseMarker),this._restartPath()},_restartPath:function(){this._distance=0,this._tooltip=void 0,this._lastCircle=void 0,this._lastPoint=void 0,this._layerPaintPath=void 0,this._layerPaintPathTemp=void 0},_createTooltip:function(i){var e=t.divIcon({className:"leaflet-measure-tooltip",iconAnchor:[-5,-5]});this._tooltip=t.marker(i,{icon:e,clickable:!1}).addTo(this._layerPaint)},_updateTooltipPosition:function(t){this._tooltip.setLatLng(t)},_updateTooltipDistance:function(t,i){var e=this._round(t),o=this._round(i),a='<div class="leaflet-measure-tooltip-total">'+e+" nm</div>";o>0&&e!=o&&(a+='<div class="leaflet-measure-tooltip-difference">(+'+o+" nm)</div>"),this._tooltip._icon.innerHTML=a},_round:function(t){return Math.round(t/1852*10)/10},_onKeyDown:function(t){27==t.keyCode&&(this._lastPoint?this._finishPath():this._toggleMeasure())}}),t.Map.mergeOptions({measureControl:!1}),t.Map.addInitHook(function(){this.options.measureControl&&(this.measureControl=new t.Control.Measure,this.addControl(this.measureControl))}),t.control.measure=function(i){return new t.Control.Measure(i)},t.Control.Measure});